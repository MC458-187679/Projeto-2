\section{Definições}

Um alpinista deve escalar uma parede representada por uma grade $n \times m$, em cada célula $(i, j)$ da grade tem um custo $C_{i, j} > 0$ associado. O alpinista deve começar na base, linha 1, e chegar no topo, linha $n$, tentando minizar o grau de periculosidade (custo total) do caminho. Quando ele se encontra na célula $(i, j)$, com $1 \leq i < n$ e $1 \leq j \leq m$, os únicos movimentos possíveis são para as células $(i+1, j-1)$, $(i+1, j)$ ou $(i+1, j+1)$, se elas fazem parte da parede.

\subsection{Definições Adicionais}

\begin{definition}[Caminho até o Topo]
    Considere um caminho $P = \left(p_1, \ldots, p_k\right)$, sendo $k$ a quantidade de vértices no caminho. Então, $P$ é um \textit{caminho até o topo} se ele termina em alguma célula do topo da parede, ou seja, $p_k = (n, j)$ para algum $1 \leq j \leq m$.
\end{definition}

\begin{definition}[Risco]
    O grau de periculosidade ou risco $R(P)$ de um caminho $P = \left(p_1, \ldots, p_k\right)$ é dado pela soma dos custos de cada célula do caminho, isto é,
    \[
        R(P) = \sum_{1 \leq i \leq k} C_{p_i}
    \]
\end{definition}

\begin{definition}[Risco Mínimo]
    O risco mínimo $R^*_{i, j}$ de uma célula $(i, j)$ é o risco de um \textit{caminho ótimo} de $(i, j)$, ou seja, um caminho até o topo $P$ com menor custo total $R(P)$ dentre os caminhos partindo de $(i, j)$.
\end{definition}

\section{Solução}

\begin{theorem}[subestrutura ótima]
    Seja $k \geq 2$ e suponha um caminho $P = \left(p_1, p_2, \ldots, p_k\right)$ até o topo partindo de $p_1$ e com risco mínimo $R(P) = R^*_{i, j}$. Então, o subcaminho $\left(p_2, \ldots, p_k\right)$ tem o menor risco possível partindo de $p_2$.
\end{theorem}

\begin{proof}
    Seja $S = \left(p_2, \ldots, p_k\right)$ o subcaminho de $P$ mencionada e suponha um caminho até o topo $S' = \left(s_1, \ldots, s_l\right)$ partindo de $s_1 = p_2$, com risco $R(S') = R^*_{p_2}$ mínimo. Assim, temos o caminho $P' = \left(p_1, s_1, \ldots, s_l\right)$, com risco
    \[
        R(P') = C_{p_1} + \sum_{i = 1}^l C_{s_i} = C_{p_1} + R(S')
    \]

    Suponha, por contradição, que $R(S') < R(S)$. Então, temos que
    \begin{align*}
        R(P') &= C_{p_1} + R(S')  \\
            &< C_{p_1} + R(S) \\
            &= C_{p_1} + \sum_{i = 2}^{k} C_{p_i} \\
            &= R(P)
    \end{align*}
    Logo, $P$ não é o caminho partindo de $p_1$ com menor risco, o que contradiz a suposição inicial.

    Portanto, $R(S') = R^*_{p_2} \geq R(S)$, isto é, $S$ tem risco mínimo, dentre os caminhos partindo de $p_2$.
\end{proof}

\subsection{Fórmula de Recorrência}

Podemos notar que o caminho nas células do topo com risco mínimo devem ter apenas a própria célula, então, $R^*_{n, j} = C_{n, j}$  para $1 \leq j \leq m$. Agora, para as células que não estão no topo, vamos ter que qualquer caminho até o topo, inclusivo um caminho ótimo $P = \left(p_1, \ldots, p_k\right)$, terá no mínimo 2 vértices, ou seja, $k \geq 2$. Portanto, pela subestrutura ótima, temos que $R^*_{p_1} = C_{p_1} + R^*_{p_2}$.

Como $p_1$ deve ser uma célula válida, então temos $1 \leq i < n$ e $1 \leq j \leq m$ tal que $p_1 = (i, j)$. No entanto, o alpinista só ir de $(i, j)$ para as células superiores esquerda, central ou direita, isto é, $p_2 = (i+1, j-1)$ ou $p_2 = (i+1, j)$ ou $p_2 = (i+1, j+1)$, dado que essas posições são válidas. No caso geral, em que $1 < j < m$, temos que
\[
    R^*_{i, j} = \min\left\{C_{i, j} + R^*_{i+1,j-1}, C_{i, j} + R^*_{i+1,j}, C_{i, j} + R^*_{i+1,j+1}\right\}
\]

Quando $j - 1 < 1$ ou $j + 1 > n$, podemos expandir a definição de risco mínimo para que $R^*_{i, j} = \infty$, mantendo a válidade da recorrência. Portanto, temos a seguinte relação de recorrência:
\begin{align*}
    R^*_{n, j} &= C_{n, j} && \text{para $1 \leq j \leq m$}\\
    R^*_{i, j} &= \infty && \text{para $1 \leq i \leq n$ e $j < 1$ ou $j > m$} \\
    R^*_{i, j} &= C_{i, j} + \min\left\{R^*_{i+1,j-1}, R^*_{i+1,j}, R^*_{i+1,j+1}\right\} && \text{para $1 \leq i < n$ e $1 \leq j \leq m$}
\end{align*}

Note que cada linha $i$ depende apenas da linhas superiores $i+1$, com exceção do caso base $i = n$, que não depende de outros custos. Então, podemos calcular toda a matriz de risco mínimo $R^*_{i, j}$ a partir do topo da parede, sem necessidade de recursão ou memorização.

O resultado final $R^*$ do algoritmo é apenas menor dos riscos dentre os caminhos partindo da base, então
\[
    R^* = \min_{1 \leq j \leq m}\left\{R^*_{1, j}\right\}
\]

\begin{minipage}[t]{0.5\textwidth}
    \begin{codebox}
        \Procname{$\proc{Risco-Mínimo}(C, n, m)$}
        \li Seja $R[1 \twodots n][1 \twodots m]$ uma nova matriz.
        \li
        \li \kw{para} $j = 1$ \kw{até} $m$
            \Do
        \li     $R[n][j] \gets C[n][j]$
            \End
        \li
        \li \kw{para} $i = n - 1$ descendo \kw{até} $1$
            \Do
        \li     $\id{R-esq} \gets \infty$
        \li     $\id{R-cen} \gets \infty$
        \li     $\id{R-dir} \gets C[i][1]$
        \li
        \li     \kw{para} $j = 1$ \kw{até} $m - 1$
                \Do
        \li         $\id{R-esq} \gets \id{R-cen}$
        \li         $\id{R-cen} \gets \id{R-dir}$
        \li         $\id{R-dir} \gets R[i+1][j+1]$
        \li
        \li         $\id{R-min} \gets \min\left(\id{R-esq}, \id{R-cen}, \id{R-dir}\right)$
        \li         $R[i][j] \gets C[i][j] + \id{R-min}$
                \End
        \li
        \li     $\id{R-esq} \gets \id{R-cen}$
        \li     $\id{R-cen} \gets \id{R-dir}$
        \li     $\id{R-dir} \gets \infty$
        \li
        \li     $\id{R-min} \gets \min\left(\id{R-esq}, \id{R-cen}, \id{R-dir}\right)$
        \li     $R[i][m] \gets C[i][m] + \id{R-min}$
            \End
        \li
        \li $\id{R-min} \gets R[1][1]$
        \li \kw{para} $j = 2$ \kw{até} $m$
            \Do
        \li     $\id{R-min} \gets \min(\id{R-min},~R[1][j])$
            \End
        \li \kw{retorna} $\id{R-min}$
    \end{codebox}
\end{minipage}%
\hfill%
\begin{minipage}[t]{0.45\textwidth}
    \section{Implementação}
\end{minipage}
